<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°SG YZ Analiz - Profesyonel SÃ¼rÃ¼m</title>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <style>
        :root { --primary: #2563eb; --success: #16a34a; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 550px; }
        #display-area { width: 100%; height: 350px; background: #000; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative; }
        video, img { width: 100%; height: 100%; object-fit: cover; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--danger); width: 100%; font-size: 1.1rem; margin-top: 10px; }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }
        .input-field { margin-top: 15px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #64748b; margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; background: #f8fafc; font-size: 0.95rem; box-sizing: border-box; }
        #status { text-align: center; font-weight: bold; color: var(--primary); margin-bottom: 10px; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <div id="status">Sistem YÃ¼kleniyor...</div>
    
    <div id="display-area">
        <video id="webcam" autoplay playsinline style="display:none;"></video>
        <img id="preview" style="display:none;">
    </div>

    <div class="btn-group">
        <button class="btn-blue" onclick="startCamera()">ğŸ“· KAMERAYI AÃ‡</button>
        <button class="btn-green" onclick="document.getElementById('fileInp').click()">ğŸ“ RESÄ°M YÃœKLE</button>
    </div>
    <input type="file" id="fileInp" hidden accept="image/*" onchange="loadFile(event)">
    <button id="analyzeBtn" class="btn btn-red" onclick="analyzeNow()" disabled>ğŸ” ÅÄ°MDÄ° ANALÄ°Z ET</button>

    <div class="input-field">
        <label>Mevcut Durum (Tehlike ve Ä°lk Ã–nlemler)</label>
        <input type="text" id="mevcutOut" readonly>
    </div>
    <div class="input-field">
        <label>Aksiyon (DÃ¼zeltici Faaliyet & O-F-Å DeÄŸiÅŸimi)</label>
        <input type="text" id="aksiyonOut" readonly>
    </div>
</div>

<script>
    let classifier;
    let currentSource = null;
    const statusText = document.getElementById('status');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const webcam = document.getElementById('webcam');
    const preview = document.getElementById('preview');

    // 35 SatÄ±rlÄ±k hedef iÃ§in geniÅŸletilebilir Ä°SG VeritabanÄ±
    const isgDB = [

    { tags: ['ladder', 'stair'], 
      mev: "YÃ¼ksekte Ã§alÄ±ÅŸma: Merdiven pabuÃ§larÄ± eksik ve sabitleme yapÄ±lmamÄ±ÅŸ.", 
      aks: "DÃ¼zeltme: Kaymaz taban takÄ±ldÄ±, sabitleme yapÄ±ldÄ± ve alan ÅŸeritle Ã§evrildi. (O:5->1, F:10->5, Å:15)" },

    { tags: ['scaffold', 'platform'], 
      mev: "Ä°skele: Korkuluk ve topuk levhasÄ± eksik.", 
      aks: "Aksiyon: EN 12811'e uygun korkuluk ve topuk levhasÄ± monte edildi. (O:6->1, F:8->4, Å:20)" },

    { tags: ['helmet', 'hat'], 
      mev: "KKD Ä°hlali: Baretsiz personel tehlikeli alanda.", 
      aks: "Aksiyon: Personel sahadan Ã§Ä±karÄ±ldÄ±, KKD denetimi artÄ±rÄ±ldÄ±. (O:7->1, F:10->10, Å:15)" },

    { tags: ['glove'], 
      mev: "Kesici iÅŸte eldiven kullanÄ±lmÄ±yor.", 
      aks: "Aksiyon: EN 388 kesilmeye dayanÄ±klÄ± eldiven temin edildi. (O:6->1, F:8->5, Å:15)" },

    { tags: ['goggles', 'eye'], 
      mev: "TaÅŸlama iÅŸleminde gÃ¶zlÃ¼k kullanÄ±lmÄ±yor.", 
      aks: "Aksiyon: EN 166 koruyucu gÃ¶zlÃ¼k zorunlu hale getirildi. (O:7->1, F:8->5, Å:25)" },

    { tags: ['electric', 'wire', 'socket'], 
      mev: "Elektrik panosunda izolasyon hasarÄ± ve aÃ§Ä±k kapak.", 
      aks: "DÃ¼zeltme: LOTO uygulandÄ±, pano kilitlendi ve izolasyon yenilendi. (O:4->1, F:10->2, Å:40)" },

    { tags: ['extension', 'cable'], 
      mev: "Uzatma kablosu zeminde geliÅŸigÃ¼zel duruyor.", 
      aks: "Aksiyon: Kablo askÄ± sistemi kuruldu, kablo kanalÄ± kullanÄ±ldÄ±. (O:5->1, F:10->4, Å:10)" },

    { tags: ['machine', 'guard'], 
      mev: "Makine koruyucusu sÃ¶kÃ¼lmÃ¼ÅŸ ÅŸekilde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor.", 
      aks: "Aksiyon: Koruyucu kapak yerine takÄ±ldÄ±, emniyet switchi kontrol edildi. (O:8->1, F:6->3, Å:40)" },

    { tags: ['press', 'hydraulic'], 
      mev: "Hidrolik pres Ã§ift el kumanda sistemi devre dÄ±ÅŸÄ±.", 
      aks: "Aksiyon: Ã‡ift el kontrol sistemi aktif hale getirildi. (O:9->1, F:6->3, Å:40)" },

    { tags: ['forklift', 'vehicle'], 
      mev: "Forklift ile yaya yollarÄ± ayrÄ±lmamÄ±ÅŸ.", 
      aks: "Aksiyon: Yaya yolu Ã§izgileri ve bariyer sistemi oluÅŸturuldu. (O:7->2, F:10->6, Å:30)" },

    { tags: ['truck', 'loading'], 
      mev: "YÃ¼kleme alanÄ±nda takoz kullanÄ±lmÄ±yor.", 
      aks: "Aksiyon: Teker takozu zorunlu hale getirildi. (O:6->1, F:8->4, Å:30)" },

    { tags: ['chemical', 'acid'], 
      mev: "Kimyasal kap Ã¼zerinde etiket bulunmuyor.", 
      aks: "Aksiyon: MSDS'e uygun etiketleme yapÄ±ldÄ±. (O:5->1, F:6->3, Å:25)" },

    { tags: ['gas', 'cylinder'], 
      mev: "Gaz tÃ¼pÃ¼ zincirle sabitlenmemiÅŸ.", 
      aks: "Aksiyon: TÃ¼p sabitleme aparatÄ± monte edildi. (O:6->1, F:6->3, Å:40)" },

    { tags: ['fire', 'extinguisher'], 
      mev: "YangÄ±n tÃ¼pÃ¼ periyodik kontrol tarihi geÃ§miÅŸ.", 
      aks: "Aksiyon: Dolum ve kontrol yenilendi. (O:4->1, F:6->3, Å:35)" },

    { tags: ['hotwork', 'welding'], 
      mev: "Kaynak iÅŸleminde yangÄ±n gÃ¶zcÃ¼sÃ¼ yok.", 
      aks: "Aksiyon: SÄ±cak Ã§alÄ±ÅŸma izni ve yangÄ±n gÃ¶zcÃ¼sÃ¼ atandÄ±. (O:7->1, F:6->3, Å:40)" },

    { tags: ['confined', 'tank'], 
      mev: "KapalÄ± alanda gaz Ã¶lÃ§Ã¼mÃ¼ yapÄ±lmamÄ±ÅŸ.", 
      aks: "Aksiyon: Ã‡oklu gaz dedektÃ¶rÃ¼ ile Ã¶lÃ§Ã¼m zorunlu hale getirildi. (O:9->1, F:5->2, Å:40)" },

    { tags: ['noise'], 
      mev: "85 dB Ã¼zeri alanda kulaklÄ±k kullanÄ±lmÄ±yor.", 
      aks: "Aksiyon: EN 352 kulak koruyucu daÄŸÄ±tÄ±ldÄ±. (O:6->1, F:10->6, Å:15)" },

    { tags: ['dust'], 
      mev: "Tozlu ortamda aspirasyon sistemi yok.", 
      aks: "Aksiyon: Lokal emiÅŸ sistemi kuruldu. (O:6->2, F:8->4, Å:20)" },

    { tags: ['slip', 'floor'], 
      mev: "Zeminde yaÄŸ birikintisi var.", 
      aks: "Aksiyon: DÃ¶kÃ¼lme temizlendi ve uyarÄ± levhasÄ± kondu. (O:7->1, F:8->4, Å:15)" },

    { tags: ['storage', 'stack'], 
      mev: "Malzemeler dÃ¼zensiz ve devrilme riski var.", 
      aks: "Aksiyon: Raf sistemi kuruldu ve yÃ¼k limiti belirlendi. (O:6->1, F:6->3, Å:25)" },

    { tags: ['manual', 'lifting'], 
      mev: "AÄŸÄ±r yÃ¼k elle taÅŸÄ±nÄ±yor.", 
      aks: "Aksiyon: Transpalet temin edildi ve eÄŸitim verildi. (O:7->2, F:8->4, Å:20)" },

    { tags: ['ergonomic', 'desk'], 
      mev: "Ofis Ã§alÄ±ÅŸanÄ±nda ergonomik olmayan oturma dÃ¼zeni.", 
      aks: "Aksiyon: Ergonomik sandalye ve monitÃ¶r yÃ¼kseltici saÄŸlandÄ±. (O:5->2, F:10->6, Å:8)" },

    { tags: ['explosion', 'atex'], 
      mev: "PatlayÄ±cÄ± ortamda ex-proof ekipman yok.", 
      aks: "Aksiyon: ATEX uygun ekipman ile deÄŸiÅŸim yapÄ±ldÄ±. (O:8->1, F:6->3, Å:40)" },

    { tags: ['lighting'], 
      mev: "Ã‡alÄ±ÅŸma alanÄ±nda yetersiz aydÄ±nlatma.", 
      aks: "Aksiyon: Lux seviyesi artÄ±rÄ±ldÄ± ve LED armatÃ¼r takÄ±ldÄ±. (O:4->1, F:10->6, Å:10)" },

    { tags: ['ventilation'], 
      mev: "KapalÄ± alanda havalandÄ±rma yetersiz.", 
      aks: "Aksiyon: Mekanik havalandÄ±rma sistemi kuruldu. (O:6->2, F:8->4, Å:25)" },

    { tags: ['biohazard'], 
      mev: "AtÄ±k su temas riski olan alanda biyolojik koruma yok.", 
      aks: "Aksiyon: Su geÃ§irmez eldiven ve yÃ¼z siperi verildi. (O:6->1, F:6->3, Å:25)" },

    { tags: ['radiation'], 
      mev: "Kaynak Ä±ÅŸÄ±nÄ±na karÅŸÄ± perdeleme yok.", 
      aks: "Aksiyon: Kaynak perdesi monte edildi. (O:6->1, F:8->4, Å:20)" },

    { tags: ['emergency', 'exit'], 
      mev: "Acil Ã§Ä±kÄ±ÅŸ Ã¶nÃ¼ kapalÄ±.", 
      aks: "Aksiyon: Alan boÅŸaltÄ±ldÄ± ve sÃ¼rekli denetim planlandÄ±. (O:7->1, F:6->3, Å:40)" },

    { tags: ['firstaid'], 
      mev: "Ä°lk yardÄ±m dolabÄ± eksik malzemeli.", 
      aks: "Aksiyon: Dolap TS 4019 standardÄ±na gÃ¶re tamamlandÄ±. (O:4->1, F:6->3, Å:20)" },

    { tags: ['naturalgas'], 
      mev: "DoÄŸalgaz hattÄ±nda gaz dedektÃ¶rÃ¼ bulunmuyor.", 
      aks: "Aksiyon: Sabit gaz algÄ±lama sistemi kuruldu. (O:8->1, F:6->3, Å:40)" }

];

    // Model YÃ¼kleme
    async function loadModel() {
        try {
            classifier = await ml5.imageClassifier('MobileNet');
            statusText.innerText = "âœ… SÄ°STEM HAZIR";
            analyzeBtn.disabled = false;
        } catch (e) {
            statusText.innerText = "âŒ Model YÃ¼klenemedi!";
            console.error(e);
        }
    }

    // Kamera BaÅŸlatma
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            webcam.srcObject = stream;
            webcam.style.display = 'block';
            preview.style.display = 'none';
            currentSource = webcam;
            statusText.innerText = "ğŸ“· CANLI KAMERA AKTÄ°F";
        } catch (e) {
            alert("Kamera izni reddedildi!");
        }
    }

    // Dosya YÃ¼kleme
    function loadFile(event) {
        const file = event.target.files[0];
        if (file) {
            const url = URL.createObjectURL(file);
            preview.src = url;
            preview.style.display = 'block';
            webcam.style.display = 'none';
            currentSource = preview;
            statusText.innerText = "ğŸ“ RESÄ°M ANALÄ°ZE HAZIR";
        }
    }

    // ANALÄ°Z ET
    async function analyzeNow() {
        if (!currentSource) {
            alert("Ã–nce bir gÃ¶rÃ¼ntÃ¼ kaynaÄŸÄ± seÃ§in!");
            return;
        }

        statusText.innerText = "â³ ANALÄ°Z YAPILIYOR...";
        
        try {
            const results = await classifier.classify(currentSource);
            const label = results[0].label.toLowerCase();
            console.log("YZ Tahmini:", label);

            // VeritabanÄ± TaramasÄ±
            const match = isgDB.find(item => item.tags.some(t => label.includes(t)));
            
            if (match) {
                document.getElementById('mevcutOut').value = match.mev;
                document.getElementById('aksiyonOut').value = match.aks;
                statusText.innerText = "âœ… ANALÄ°Z BAÅARILI";
            } else {
                document.getElementById('mevcutOut').value = "TESPÄ°T: " + label.split(',')[0].toUpperCase();
                document.getElementById('aksiyonOut').value = "Ã–zel aksiyon planÄ± bulunamadÄ±. Genel denetim prosedÃ¼rÃ¼nÃ¼ iÅŸletin.";
                statusText.innerText = "âš ï¸ BÄ°LÄ°NMEYEN NESNE";
            }
        } catch (err) {
            statusText.innerText = "âŒ ANALÄ°Z HATASI!";
            console.error(err);
        }
    }

    loadModel();
</script>
</body>
</html>
